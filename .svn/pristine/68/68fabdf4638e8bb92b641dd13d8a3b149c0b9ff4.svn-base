

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>活动管理</title>
    <link href="/static/css/layout.css" rel="stylesheet" type="text/css" />
    <link href="/static/css/page.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <script type="text/javascript" src="/static/js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="/static/js/del-checked.js"></script>
    <script type="text/javascript" src="/static/js/layer/layer.js"></script>
    <script type="text/javascript" src="/static/js/ContorlValidator.js"></script>
    <script type="text/javascript" src="/static/js/CostomLinkOpenSw.js"></script>
    <link href="/static/js/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="/static/js/daterangepicker/moment.min.js"></script>
    <script type="text/javascript" src="/static/js/daterangepicker/daterangepicker.js"></script>
    <script type="text/javascript" src="/static/js/lhgdialog.js?skin=aero"></script>
    <style>
        .layui-layer.layui-layer-page.layui-layer-rim.layer-anim .layui-layer-content{
            padding: 10px;
        }
        .layui-layer.layui-layer-page.layui-layer-rim.layer-anim *{
            max-width : 100%!important;
            box-sizing: border-box;
        }
        .layui-layer.layui-layer-page.layui-layer-rim.layer-anim img{
            height: auto!important;
        }
    </style>


    <script type="text/javascript">
        window.UEDITOR_Admin_URL = "/public/plugins/Ueditor/";
        var URL_upload = "/index.php/Admin/Ueditor/imageUp/savepath/article";
        var URL_fileUp = "/index.php/Admin/Ueditor/fileUp/savepath/article";
        var URL_scrawlUp = "/index.php/Admin/Ueditor/scrawlUp/savepath/article";
        var URL_getRemoteImage = "/index.php/Admin/Ueditor/getRemoteImage/savepath/article";
        var URL_imageManager = "/index.php/Admin/Ueditor/imageManager/savepath/article";
        var URL_imageUp = "/index.php/Admin/Ueditor/imageUp/savepath/article";
        var URL_getMovie = "/index.php/Admin/Ueditor/getMovie/savepath/article";
        var URL_home = "";
    </script>
    <!--
    <script>
        KindEditor.ready(function(K) {
            window.editor = K.create('#editor_id');
        });
    </script>
-->
    <script language="javascript">
        //具体参数配置在  editor_config.js 中
        var options = {
            zIndex: 999,
            initialFrameWidth: 558, //初化宽度
            initialFrameHeight: 400, //初化高度
            focus: false, //初始化时，是否让编辑器获得焦点true或false
            maximumWords: 99999, removeFormatAttributes: 'class,style,lang,width,height,align,hspace,valign',//允许的最大字符数 'fullscreen',
            pasteplain:false, //是否默认为纯文本粘贴。false为不使用纯文本粘贴，true为使用纯文本粘贴
            autoHeightEnabled: false
            /*   autotypeset: {
             mergeEmptyline: true,        //合并空行
             removeClass: true,           //去掉冗余的class
             removeEmptyline: false,      //去掉空行
             textAlign: "left",           //段落的排版方式，可以是 left,right,center,justify 去掉这个属性表示不执行排版
             imageBlockLine: 'center',    //图片的浮动方式，独占一行剧中,左右浮动，默认: center,left,right,none 去掉这个属性表示不执行排版
             pasteFilter: false,          //根据规则过滤没事粘贴进来的内容
             clearFontSize: false,        //去掉所有的内嵌字号，使用编辑器默认的字号
             clearFontFamily: false,      //去掉所有的内嵌字体，使用编辑器默认的字体
             removeEmptyNode: false,      //去掉空节点
             //可以去掉的标签
             removeTagNames: {"font": 1},
             indent: false,               // 行首缩进
             indentValue: '0em'           //行首缩进的大小
             }*/
        };
        function sel_address(){
            var lng=$("#chrmaplng").val();
            var lat=$("#chrmaplat").val();
            CustomOpen("/static/map/test.php?lng="+lng+"&lat="+lat,"sel_address","选择地址",950,680);
        }
    </script>
    <script type="text/javascript" src="/static/plugins/Ueditor/ueditor.config.js"></script>
    <script type="text/javascript" src="/static/plugins/Ueditor/ueditor.all.js"></script>
</head>
<body>

<div class="oa_pop">
    <div class="oa_pop-main">
        <div style="height: 6px"></div>
        <div class="oa_title clearfix">
            <span class="oa_ico-right"></span>
            <span class="oa_title-btn"></span>
            <span class="oa_ico-left"></span>
            学员管理        </div>
        <div class="oa_edition">
            <form id="frm" action="" method="post">
                <table id="tabcontent" width="100%" border="0" cellspacing="1" cellpadding="0" class="oa_edition" style="border-bottom: #e0e0e0 solid 1px">
                    <tr>
                        <td width="150"class="oa_cell-left"><span style="color:#ff0000">*</span>学员姓名：</td>
                        <td class="oa_cell-right"><input name="name" id="name" type="text" value="{$stu.name}" class="form-control "  style="width:400px;"   chname="活动名称"  /> </td>
                    </tr>
                    <tr>
                        <td width="150"class="oa_cell-left">学员出生日期：</td>
                        <td class="oa_cell-right">
                            <input type="text"   style="width: 150px;"  autocomplete="off" id="age" name="age" class="form-control"  value="{$stu['age']}"/>
                            <script language='JavaScript'>seltime("age","YYYY-MM-DD");</script>
                        </td>
                    </tr>
                    <tr>
                        <td width="150"class="oa_cell-left">学员性别：</td>
                        <td class="oa_cell-right">
                            <select name="sex" id="intselmarket" class="form-control" style="width: auto; height: 34px" >
                                <option value="" <?php  if($stu['sex']==''){echo "selected";} ?>>==请选择==</option>
                                <option value="1"  <?php  if($stu['sex']=='男'){echo "selected";} ?> >男</option>
                                <option value="2"  <?php  if($stu['sex']=='女'){echo "selected";} ?>>女</option>
                                <option value="3"  <?php  if($stu['sex'] !='男' && $stu['sex'] != '女' && $stu['sex'] !=''){echo "selected";} ?>>未知</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td width="150" class="oa_cell-left">学员身份证号：</td>
                        <td class="oa_cell-right">
                            <input type="text" style="width: 150px;"  autocomplete="off"  id="idcard" name="idcard" class="form-control"  value="{$stu.idcard}">
                        </td>
                    </tr>
                    <tr>
                        <td width="150" class="oa_cell-left">学员手机号：</td>
                        <td class="oa_cell-right">
                            <input name="phone" id="phone" type="text" value="{$stu.phone}"   class="form-control "  style="width:150px;" />
                        </td>
                    </tr>
                    <tr>
                        <td width="150" class="oa_cell-left">学员家长：</td>
                        <td class="oa_cell-right">
                            <div id="alt_p">
                             <?php $ss=0; ?>
                            {empty name="parents"}
                            {else /}
                            {volist name="parents" id= "vo" key="k"}
                                <?php $ss=$k; ?>
                                <div class="div{$k}">
                            <input type="text" name="parentname[]" value="{$vo.name}"  readonly="true"/>  <input type="text" name="parentphone[]" value="{$vo.phone}" readonly="true"/>
                                <input type="hidden" name="parentoid[]" value="{$vo.openid}">
                                <a href="javascript:CustomOpen('{:url('act/chose_parent',array('act'=>$k,'opid'=>$vo['openid']))}', 'zz','修改', 420,350)">修改</a> <a class="del_p" href="javascript:;">删除</a><br>
                                </div>
                            {/volist}
                            {/empty}
                            </div>

                            <a id="add_p" style="display: <?php  if(count($parents) >=3){ echo 'none';} ?>" href="javascript:CustomOpen('{:url('act/chose_parent','&sid='.$stu['id'])}', 'zz','增加活动', 420,350)">增加学员家长</a>

                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" style="padding:10px;">

                            <input type="button" style="display: none" onclick="javascript:checkdata(0);" value="提交">

                            <input type="hidden" id="intflag" name="intflag" value="0" />
                            <input type="button"  class="checkdata" value="保存">
                            <br/><br/>
                        </td>
                    </tr>
                </table>

            </form>
        </div>
        <div style="height: 30px"></div>
    </div>
</div>
<script>
    $('#alt_p').on('click','.del_p',function(){
       var obj=$(this)
        layer.confirm('您确定要删除吗？', {
            btn: ['确定','取消'] //按钮
        }, function(){
            var p_length=$('#alt_p').children().children('br').length;
            console.log(p_length)
            if(p_length <= 3){
                $("#add_p").show()
            }
           obj.parent().remove()
            layer.closeAll()
        }, function(){
        });
    })

     var kk={$ss};
    function add_p(name1,openid,phone){
        kk++;
        var html='<input type="text" name="parentname[]" value="'+name1+'" readonly="true"/>';
        html+='<input type="hidden" name="parentoid[]" value="'+openid+'">';
        html+='<input type="text" name="parentphone[]" value="'+phone+'" readonly="true"/>';
        html='<div class="div'+kk+'">'+html+"<a href=\"javascript:CustomOpen('{:url('act/chose_parent')}?act="+kk+"&opid="+openid+"', 'zz','修改', 420,350)\">修改</a> <a class=\"del_p\" href=\"javascript:;\">删除</a><br>"+'</div>'
        $("#alt_p").append(html);
        var p_length=$('#alt_p').children().children('br').length;
        //console.log(p_length)
        if(p_length >=3){
            $("#add_p").hide()
        }
    }

    function alt_p(name1,openid,phone,k){
        var html='<input type="text" name="parentname[]" value="'+name1+'" readonly="true"/>';
        html+='<input type="hidden" name="parentoid[]" value="'+openid+'" />';
        html+='<input type="text" name="parentphone[]" value="'+phone+'" readonly="true"/>';
        html='<div class="div'+k+'">'+html+"<a href=\"javascript:CustomOpen('{:url('act/chose_parent')}?act="+k+"&opid="+openid+"', 'zz','修改', 420,350)\">修改</a> <a class=\"del_p\" href=\"javascript:;\">删除</a><br>"+'</div>'
        $(".div"+k).replaceWith(html);
    }

    $(".checkdata").click(function(){
        if(!$.trim($("#name").val())){
            layer.alert('请输入学员的姓名')
            return false
        }

        if($.trim($("#age").val())){
            if(!isDate($("#age").val())){
                layer.alert('请输入格式为yyyy-mm-dd的日期')
                return false
            }
        }
        if($.trim($("#idcard").val())){
            if(!/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[012])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test($.trim($("#idcard").val()))){
                layer.alert('请输入正确的身份证号码')
                return false
            }
        }
        if($.trim($("#phone").val())){

            if(!/^1[3456789]\d{9}$/.test($.trim($("#phone").val()))){
                layer.alert('请输入正确的手机号码')
                return false
            }
        }


$("#frm").submit()


    })

    function isDate(dateString){
        if(dateString.trim()=="")return true;
        var r=dateString.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);
        if(r==null){
            return false;
        }
        var d=new Date(r[1],r[3]-1,r[4]);
        var num = (d.getFullYear()==r[1]&&(d.getMonth()+1)==r[3]&&d.getDate()==r[4]);
        return (num!=0);
    }
</script>
</body>
</html>