<!--
 * @Descripttion: 
 * @version: 
 * @Author: ChenJie
 * @Date: 2019-09-06 11:45:07
 * @LastEditors: ChenJie
 * @LastEditTime: 2019-09-10 17:52:54
 -->
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml">
 
 <head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <title>新增子产品</title>
   <link href="__PUBLIC__/static/css/layout.css" rel="stylesheet" type="text/css" />
   <link href="__PUBLIC__/static/css/page.css" rel="stylesheet" type="text/css" />
   <script type="text/javascript" src="__PUBLIC__/static/js/jquery-3.2.1.min.js"></script>
   <script type="text/javascript" src="__PUBLIC__/static/js/del-checked.js"></script>
   <script type="text/javascript" src="__PUBLIC__/static/js/layer/layer.js"></script>
   <script type="text/javascript" src="__PUBLIC__/static/js/ContorlValidator.js"></script>
   <script type="text/javascript" src="__PUBLIC__/static/js/CostomLinkOpenSw.js"></script>
   <link href="__PUBLIC__/static/js/daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css" />
   <script type="text/javascript" src="__PUBLIC__/static/js/daterangepicker/moment.min.js"></script>
   <script type="text/javascript" src="__PUBLIC__/static/js/daterangepicker/daterangepicker.js"></script>
   <script type="text/javascript" src="__PUBLIC__/static/js/lhgdialog.js?skin=aero"></script>
   <link type="text/css" href="__PUBLIC__/static/plugins/layui/css/layui.css" rel="stylesheet" />
   <script type="text/javascript" src="__PUBLIC__/static/plugins/layui/layui.js"></script>
   <style>
     .layui-layer.layui-layer-page.layui-layer-rim.layer-anim .layui-layer-content {
       padding: 10px;
     }
 
     .layui-layer.layui-layer-page.layui-layer-rim.layer-anim * {
       max-width: 100% !important;
       box-sizing: border-box;
     }
 
     .layui-layer.layui-layer-page.layui-layer-rim.layer-anim img {
       height: auto !important;
     }
     .business_hours_list{
         width: 800px;
         margin-top: 10px;
     }
     .business_hours_list .layui-btn{
         margin-left: 0;
         margin-right: 10px;
         margin-bottom: 10px;
     }
     .layui-upload-list img{
        width: 200px;
        height: 150px;;
    }
    .layui-form-onswitch{
        border-color: #1E9FFF;
        background-color: #1E9FFF;
    }
    #store_list .layui-form-checkbox,#week_list .layui-form-checkbox{
        display: none;
    }
    #store_list .layui-input-inline,#week_list .layui-input-inline{
        margin-right: 10px;
    }
    .image-container{
        display: inline-block;
        width: 255px;
        height: 150px;
    }
    .image-container img{
        display: inline-block;
    }
    .image-container .delete-img{
        display: inline-block;
        margin-left: 10px;
        vertical-align: top;
    }
   </style>
 
   <script type="text/javascript">
     window.UEDITOR_Admin_URL = "/public/plugins/Ueditor/";
     var URL_upload = "/index.php/Admin/Ueditor/imageUp/savepath/article";
     var URL_fileUp = "/index.php/Admin/Ueditor/fileUp/savepath/article";
     var URL_scrawlUp = "/index.php/Admin/Ueditor/scrawlUp/savepath/article";
     var URL_getRemoteImage = "/index.php/Admin/Ueditor/getRemoteImage/savepath/article";
     var URL_imageManager = "/index.php/Admin/Ueditor/imageManager/savepath/article";
     var URL_imageUp = "/index.php/Admin/Ueditor/imageUp/savepath/article";
     var URL_getMovie = "/index.php/Admin/Ueditor/getMovie/savepath/article";
     var URL_home = "";
   </script>
   <!--
     <script>
         KindEditor.ready(function(K) {
             window.editor = K.create('#editor_id');
         });
     </script>
 -->
   <script language="javascript">
     //具体参数配置在  editor_config.js 中
     var options = {
       zIndex: 999,
       initialFrameWidth: 800, //初化宽度
       initialFrameHeight: 200, //初化高度
       focus: false, //初始化时，是否让编辑器获得焦点true或false
       maximumWords: 99999, removeFormatAttributes: 'class,style,lang,width,height,align,hspace,valign',//允许的最大字符数 'fullscreen',
       pasteplain: false, //是否默认为纯文本粘贴。false为不使用纯文本粘贴，true为使用纯文本粘贴
       autoHeightEnabled: false
       /*   autotypeset: {
        mergeEmptyline: true,        //合并空行
        removeClass: true,           //去掉冗余的class
        removeEmptyline: false,      //去掉空行
        textAlign: "left",           //段落的排版方式，可以是 left,right,center,justify 去掉这个属性表示不执行排版
        imageBlockLine: 'center',    //图片的浮动方式，独占一行剧中,左右浮动，默认: center,left,right,none 去掉这个属性表示不执行排版
        pasteFilter: false,          //根据规则过滤没事粘贴进来的内容
        clearFontSize: false,        //去掉所有的内嵌字号，使用编辑器默认的字号
        clearFontFamily: false,      //去掉所有的内嵌字体，使用编辑器默认的字体
        removeEmptyNode: false,      //去掉空节点
        //可以去掉的标签
        removeTagNames: {"font": 1},
        indent: false,               // 行首缩进
        indentValue: '0em'           //行首缩进的大小
        }*/
     };
   </script>
   <script type="text/javascript" src="__PUBLIC__/static/plugins/Ueditor/ueditor.config.js"></script>
   <script type="text/javascript" src="__PUBLIC__/static/plugins/Ueditor/ueditor.all.js"></script>
 </head>
 
 <body>
   <div class="oa_pop">
     <div class="oa_pop-main">
       <div style="height: 6px"></div>
       <div class="oa_title clearfix">
         <span class="oa_ico-right"></span>
         <span class="oa_title-btn"></span>
         <span class="oa_ico-left"></span>
         {$param.id ? '修改' : '新建'}子产品
       </div>
       <div class="oa_edition">
         <form id="frm" class="layui-form" action="" method="post" onsubmit="return checkdata()">
           <input type="hidden" name="id" value="{$datainfo.id ?? 0}" />
 
           <table id="tabcontent" width="100%" border="0" cellspacing="1" cellpadding="0" class="oa_edition"
             style="border-bottom: #e0e0e0 solid 1px">
             <tr>
               <td width="150" class="oa_cell-left"><span style="color:#ff0000">*</span>子产品名称：</td>
               <td class="oa_cell-right"><input name="store_name" id="store_name" type="text"
                   value="{$datainfo.store_name ?? ''}" class="layui-input " style="width:600px;" />
               </td>
             </tr>
             <tr>
                <td width="150" class="oa_cell-left"><span style="color:#ff0000">*</span>子产品图片：</td>
                <td class="oa_cell-right">
                    <button type="button" class="layui-btn layui-btn-normal" id="sub_product_images">图片批量上传</button> 
                    <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
                        产品图片预览：
                        <div class="layui-upload-list" id="sub_product_images_preview"></div>
                    </blockquote>
                </td>
             </tr>
             <tr>
                <td width="150" class="oa_cell-left"><span style="color:#ff0000">*</span>子产品详情：</td>
                <td class="oa_cell-right">
                    <div ><textarea  style="width:800px;height:400px;" class="span12 ckeditor" id="sub_product_detail" is_null="1" name="sub_product_detail">{$datainfo.sub_product_detail ?? ''}</textarea></div>
                    <script>var editorcontent;$(function(){editorcontent = new UE.ui.Editor(options);editorcontent.render("sub_product_detail");});</script>
                </td>
             </tr>
             <tr>
                <td width="150" class="oa_cell-left"><span style="color:#ff0000">*</span>启用取消预约：</td>
                <td class="oa_cell-right">
                    <input type="checkbox" name="is_cancle_reserve" value="1" lay-filter="isCancleReserve" lay-text="启用|停用" lay-skin="switch">
                </td>
            </tr>
            <tr id="cacleReserveSet" style="display: none">
                <td width="150" class="oa_cell-left"><span style="color:#ff0000">*</span>可取消预约：</td>
                <td class="oa_cell-right">
                    <input name="cancle_day" id="cancle_day" type="text"
                        value="{$datainfo.cancle_day ?? ''}" class="layui-input" style="display: inline; width:100px;" />天内
                </td>
            </tr>
            <tr>
                <td width="150" class="oa_cell-left"><span style="color:#ff0000">*</span>所属门店：</td>
                <td class="oa_cell-right" id="store_list">
                    <div class="layui-input-inline">
                        <input type="checkbox" name="storeList[]" value="10" style="display: none">
                        <button type="button" class="layui-btn layui-btn-primary">A门店</button>
                    </div>
                    <div class="layui-input-inline">
                        <input type="checkbox" name="storeList[]" value="11" style="display: none">
                        <button type="button" class="layui-btn layui-btn-primary">B门店</button>
                    </div>
                    <div class="layui-input-inline">
                        <input type="checkbox" name="storeList[]" value="12" style="display: none">
                        <button type="button" class="layui-btn layui-btn-primary">C门店</button>
                    </div>
                </td>
            </tr>
            <tr>
                <td width="150" class="oa_cell-left"><span style="color:#ff0000">*</span>活动有效期：</td>
                <td class="oa_cell-right">
                    <input type="text" class="layui-input" id="activity_time" placeholder="请选择活动有效期" style="width: 300px;">
                </td>
            </tr>
            <tr>
                <td width="150" class="oa_cell-left"><span style="color:#ff0000">*</span>启用提前预约：</td>
                <td class="oa_cell-right">
                    <input type="checkbox" name="is_advance_day" value="1" lay-filter="isAdvanceDay" lay-text="启用|停用" lay-skin="switch">
                </td>
            </tr>
            <tr id="advanceDaySet" style="display: none">
                <td width="150" class="oa_cell-left"><span style="color:#ff0000">*</span>预约提前天数：</td>
                <td class="oa_cell-right">
                    <input name="advance_day" id="advance_day" type="text"
                        value="{$datainfo.advance_day ?? ''}" class="layui-input " style="display: inline; width:100px;" />天内
                </td>
            </tr>
            <tr>
                <td width="150" class="oa_cell-left"><span style="color:#ff0000">*</span>选择星期：</td>
                <td class="oa_cell-right" id="week_list">
                    <div class="layui-input-inline">
                        <input type="checkbox" name="weekList[]" value="1" style="display: none">
                        <button type="button" class="layui-btn layui-btn-primary">周一</button>
                    </div>
                    <div class="layui-input-inline">
                        <input type="checkbox" name="weekList[]" value="2" style="display: none">
                        <button type="button" class="layui-btn layui-btn-primary">周二</button>
                    </div>
                    <div class="layui-input-inline">
                        <input type="checkbox" name="weekList[]" value="3" style="display: none">
                        <button type="button" class="layui-btn layui-btn-primary">周三</button>
                    </div>
                    <div class="layui-input-inline">
                        <input type="checkbox" name="weekList[]" value="4" style="display: none">
                        <button type="button" class="layui-btn layui-btn-primary">周四</button>
                    </div>
                    <div class="layui-input-inline">
                        <input type="checkbox" name="weekList[]" value="5" style="display: none">
                        <button type="button" class="layui-btn layui-btn-primary">周五</button>
                    </div>
                    <div class="layui-input-inline">
                        <input type="checkbox" name="weekList[]" value="6" style="display: none">
                        <button type="button" class="layui-btn layui-btn-primary">周六</button>
                    </div>
                    <div class="layui-input-inline">
                        <input type="checkbox" name="weekList[]" value="7" style="display: none">
                        <button type="button" class="layui-btn layui-btn-primary">周日</button>
                    </div>
                </td>
            </tr>
            <tr>
                <td width="150" class="oa_cell-left"><span style="color:#ff0000">*</span>是否使用时间段：</td>
                <td class="oa_cell-right">
                    <input type="checkbox" name="status" value="1" lay-filter="status" lay-text="启用|停用" lay-skin="switch">
                    <span style="color:#ff0000">备注：开启使用时间段，将自动读取门店营业时间</span>
                </td>
            </tr>
             <tr class="paytypecontent2">
               <td width="150" class="oa_cell-left"> </td>
               <td class="table_head">
                 <div id="spec_table2">
                 </div>
               </td>
             </tr>
             <tr id="save">
               <td colspan="2" style="padding:10px;">
                 <input type="submit" lay-submit="" lay-filter="demo1" value="保存"
                   style="-webkit-appearance: button;cursor: pointer;font-family: inherit;font-size: inherit;line-height: inherit;padding: 1px 6px;">
               </td>
             </tr>
           </table>
         </form>
       </div>
       <div style="height: 30px"></div>
     </div>
   </div>
 
 </body>
 <script>
     // 时间选择控件
     layui.use(['form','upload','laydate'], function(){
        var form = layui.form,upload = layui.upload,laydate = layui.laydate;
        upload.render({
            elem: '#sub_product_images'
            ,url: "{:url('Ueditor/imageUpload')}"
            ,accept: 'images'
            ,acceptMime: 'image/*'
            ,field: 'sub_product_images'
            ,multiple: true
            ,data:{'savedirectory':'subproduct'}
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    var files = obj.pushFile();
                    $('#sub_product_images_preview').append('<div class="image-container" id="container-'+index+'"><img src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img"><div class="delete-img" id="delete-img-'+index+'"><button id="upload_img_'+index+'" type="button" class="layui-btn layui-btn-danger layui-btn-xs">删除</button></div></div>');
                    $("#upload_img_" + index).bind('click', function (e) {
                        delete files[index];
                        $("#container-"+index).remove();
                    });
                });
            }
            ,done: function(res){
                if(res.code == -1){
                    return layer.msg('上传失败');
                }
                $('#sub_product_images').before('<input type="hidden" name="sub_product_images[]" value="'+res.data.filepath+'" />');
            }
        });

        // 启用取消预约
        form.on('switch(isCancleReserve)', function(data){
            if(this.checked){
                $('#cacleReserveSet').show();
            }else{
                $('#cacleReserveSet').hide();
            }
        });
        // 启用提前天数
        form.on('switch(isAdvanceDay)', function(data){
            if(this.checked){
                $('#advanceDaySet').show();
            }else{
                $('#advanceDaySet').hide();
            }
        });
        // 活动有效期
        laydate.render({
            elem: '#activity_time'
            ,range: true
        });

        //监听提交
        form.on('submit(demo1)', function(data){
            var formData = new FormData($( "#frm" )[0]);
            console.log(formData);
            layer.alert(JSON.stringify(data.field), {
            title: '最终的提交信息'
            })
            return false;
        });
     });

     // 门店选择
     $('#store_list button').click(function(){
         if(!$(this).hasClass("layui-btn-normal")){
            $(this).siblings("input").attr("checked",true);
         }else{
            $(this).siblings("input").attr("checked",false);
         }
        $(this).toggleClass("layui-btn-primary").toggleClass("layui-btn-normal");
     });

     // 星期选择
     $('#week_list button').click(function(){
        if(!$(this).hasClass("layui-btn-normal")){
            $(this).siblings("input").attr("checked",true);
        }else{
            $(this).siblings("input").attr("checked",false);
        }
        $(this).toggleClass("layui-btn-primary").toggleClass("layui-btn-normal");
     });
 </script>
 </html>