<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="yes" name="apple-touch-fullscreen">
  <meta content="telephone=no,email=no" name="format-detection">
  <meta name="viewport"
    content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,user-scalable=0" />
  <script src="__PUBLIC__/static/template/pub/js/common.js"></script>
  <link rel="stylesheet" href="__PUBLIC__/static/template/pub/css/main.css?v={:time()}">
  <link rel="stylesheet" href="__PUBLIC__/static/template/skin/M1/css/skin.css?v={:time()}">
  
  <title>代言注册</title>
</head>

<body class="flexCol">
  {include file="modules/common/header" /}
  <section class="section">
    <form action="" method="post" id="form1" class="exchange-form" onsubmit="return false">
      <ul>
        <li class="title fontColor">*请如实填写以下信息</li>
        <li>
          <label for="username" class="tit">姓名：</label>
          <input type="text" id="username" name="u_chrname" value="" class="txt" placeholder="请输入姓名">
        </li>
        <li>
          <label for="usertel" class="tit">电话：</label>
          <input type="text" id="usertel" name="u_chrtel" value="" class="txt" placeholder="请输入电话">
        </li>
        <li>
          <label for="usertel" class="tit">结算微信号：</label>
          <input type="text" id="userweChat" name="wechat_number" value="" class="txt" placeholder="请输入结算微信号">
        </li>
        <li>
          <label for="usertel" class="tit">身份证号：</label>
          <input type="text" id="userid" name="u_identity_card_num" value="" class="txt" placeholder="请输入身份证号">
        </li>
      </ul>
      <div class="btns-center">
        <input id="subbtn" type="button" onclick="sub_form()" class="sub-btn" value="提交">
      </div>
    </form>
  </section>
  
  <footer class="footer">

  </footer>
  <script src="__PUBLIC__/static/template/pub/js/jquery.min.js"></script>
  <script src="__PUBLIC__/static/template/pub/js/menu.js"></script>
  <script type="text/javascript" src="__PUBLIC__/static/js/layer/layer.js"></script>

    <script>
        $(document).ready(function() {
            //如果未关注的用户领取给他提示
            {if condition="$user_info['intstate'] != 1"}
            layer.confirm('<div style="text-align: center"><img style="width: 150px;height: 150px" src="{$qrcodeurl}" /><br>没有关注公众号，请先关注后才能申请代言人</div>',{btn:['关闭']});return;
            {/if}
                {if condition="$user_info['spokesman_grade'] != 0"}
                    layer.alert('您已经是代言用户，不需要重复绑定');return false;
                {/if}
        })
    </script>
    <script>
    //提交表单时的校验
        function sub_form() {
            var state = {$user_info['intstate']};
            if(state != 1){
                layer.confirm('<div style="text-align: center"><img style="width: 150px;height: 150px" src="{$qrcodeurl}" /><br>没有关注公众号，请先关注后才能申请代言人</div>',{btn:['关闭']});
                return false;
            }
            {if condition="$user_info['spokesman_grade'] != 0"}
            layer.alert('您已经是代言用户，不需要重复绑定');return false;
            {/if}
            //姓名
            var u_chrname = $('input[name="u_chrname"]').val();
            //电话
            var u_chrtel = $('input[name="u_chrtel"]').val();
            //身份证号
            var u_identity_card_num = $('input[name="u_identity_card_num"]').val();
            //微信号
            var wechat_number = $('input[name="wechat_number"]').val();

            var isMobile = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1})|(14[0-9]{1}))+\d{8})$/;
            //校验身份证号
            var reg =/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/;

            if(u_chrname == ''){
                layer.alert('姓名必填');
                return false;
            }
            if(u_chrtel == ''){
                layer.alert('手机号必填');
                return false;
            }
            if(isMobile.test(u_chrtel)==false)
            {
                layer.alert('手机号格式不正确');
                return false;
            }
            if(wechat_number == ''){
                layer.alert('结算微信号必填');
                return false;
            }
            if(u_identity_card_num == ''){
                layer.alert('身份证必填');
                return false;
            }
            if(reg.test(u_identity_card_num)==false)
            {
                layer.alert('身份证格式不正确');
                return false;
            }
            var data = new FormData(document.getElementById("form1"));
            // console.log(data);
            // return false;
            //分享id
            var share_id = '{$share_id}';
            layer.load(1, {
                shade: [0.1,'#fff'] //0.1透明度的白色背景
            });
            $.ajax({
                type: 'post',
                url: "/{$sitecode}/ajaxspokesmanregister",
                dataType: 'json',
                data: data,
                contentType: false, //不设置内容类型
                processData: false, //不处理数据
                success: function (data) {
                    layer.closeAll('loading');
                    if(data.code == 0){
                        layer.alert(data.message);
                    }else{
                        window.location = '/{$sitecode}/mine';
                    }
                }
            })
        }
    </script>
</body>
</html>