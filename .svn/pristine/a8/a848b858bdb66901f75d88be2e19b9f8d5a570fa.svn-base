
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>内容管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="/layuiadmin/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/admin.css" media="all">
    <link rel="stylesheet" href="/layuiadmin/style/public.css">
    <script src="/layuiadmin/js/jquery-3.3.1.js"></script>

</head>

<body>

<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">

                <!-- 搜索区域 -->

                <div class="layui-card-body">
                    <div class="layui-card">
                        <div class="layui-card-header2">搜索
                        </div>

                        <div class="layui-form layui-bd layui-mb15" action="" lay-filter="component-form-group">
                            {foreach name="modelfield" item="vl" key="k"}
                            {if condition="$vl.issearch eq 1"}
                            {in name="vl.fieldtype" value="4,5,6,7"}  <!--4 多选 5复选 6单选按钮 7下拉列表-->
                            <form class="layui-form" action="" id="form1" method="post">
                            <div class="layui-form-item">
                                <label class="layui-form-label">{$vl['fieldalias']}：</label>
                                <div class="layui-input-block">
                                    {$vl|getControl=$search[$vl['fieldname']]}
                                    <!--<input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入标题"-->
                                           <!--class="layui-input">-->
                                </div>
                            </div>
                            {else /}
                            <div class="layui-form-item">
                                <label class="layui-form-label">{$vl['fieldalias']}：</label>
                                <div class="layui-input-block">
                                    <input class="layui-input" type="text" name="{$vl['fieldname']}" value="{$search[$vl['fieldname']]}" >
                                    <!--<input type="text" name="title" lay-verify="title" autocomplete="off" placeholder="请输入标题"-->
                                           <!--class="layui-input">-->
                                </div>
                            </div>
                            {/in}
                            {/if}
                            {/foreach}

                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label"></label>

                                </div>
                                <div class="layui-inline">
                                    <button class="layui-btn" type="button" onclick="javascript:shearch_check();" >
                                        <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                                    </button>
                                </div>
                            </div>
                            </form >
                            <script>
                                function shearch_check(){
                                    $("#form1").submit()
                                }
                            </script>
                        </div>
                    </div>
                        </div>
                    </div>

                    <table class="layui-hide" id="test-table-toolbar" lay-filter="test-table-toolbar"></table>

                    <script type="text/html" id="test-table-switchTpl">
                        <!-- 这里的 checked 的状态只是演示 -->
                        <input type="checkbox" name="sex" lay-skin="switch" lay-text="女|男" lay-filter="test-table-sexDemo"
                               value="{{ d.id }}" data-json="{{ encodeURIComponent(JSON.stringify(d)) }}"
                               {{ d.id == 10003 ? 'checked' : '' }}>
                    </script>

                    <script type="text/html" id="buttonTpl">
                        {{#  if(d.username=='李清照'){ }}
                        <div class="layui-btn layui-btn-xs">李清照</div>
                        {{#  } else { }}
                        {{d.username}}
                        {{#  } }}
                    </script>

                    <script type="xt/html" id="test-table-toolbar-toolbarDemo">
              <div class="layui-btn-container ov-hd">
                <div class="info-l fl">内容列表</div>
                <div class="info-l fr">
                 <button class="layui-btn layui-btn-sm" type="button" onclick="javascript:CustomOpen('http://www.baidu.com','abc','测试百度','90%','90%')">添加内容</button></div>

            </script>

                    <script type="text/html" id="test-table-toolbar-barDemo">
                        <div class="test-table-toolbar-barDemo" style="white-space:normal;text-align: left;">


                        </div>

                    </script>

                    <div style="overflow: hidden">
                        <div style="float: left; margin-top: 15px;margin-left: 10px; vertical-align: middle;">
                            <button class="layui-btn layui-btn-sm" data-type="del">删除</button>
                        </div>
                        <div id="laypage" style="text-align: right; margin-right: 15px;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/layuiadmin/layui/layui.js"></script>
<script language="JavaScript">
    var layer = layui.layer;
    function CustomOpen(url, code, showName, w, h) {
        layer.open({
            type: 2,
            title: showName,
            shade: false,
            maxmin: true,
            area: [w, h],
            content: url
        });
    }


</script>

<script>
    layui.config({
        base: '/layuiadmin/' //静态资源所在路径
    }).extend({
        index: 'lib/index' //主入口模块
    }).use(['index', 'table', 'laydate'], function () {
        var admin = layui.admin
            , laypage = layui.laypage
            , table = layui.table


        table.render({
            elem: '#test-table-toolbar'
            , toolbar: '#test-table-toolbar-toolbarDemo'
            , title: '内容列表'
            , defaultToolbar: false
            , cols: [[
                { type: 'checkbox' }
                , { field: 'contendid', title: '内容ID', width: 80, unresize: true }
                {foreach name="modelfield" item="vo" key="k"}
                {if condition="$vo.isdisplayonlist eq 1"}
                ,{field: "{$vo.fieldname}",title:"{$vo.fieldalias}",unresize: true,{if condition="($vo.fieldname eq 'title')"}{elseif condition="($vo.fieldname eq 'hits') OR  ($vo.fieldname eq 'idorder')"}width:80{elseif condition="$vo.fieldname eq 'sys00003'" /}width:200{else /}width:120{/if}}
                {/if}
                {/foreach}
            ]]

            , data: [
                    {volist name="list" id="vo"}
                    {
                    "contendid": "{$vo['contentid']}"
                    {foreach name="modelfield" item="vl" key="k"}
                    {if condition="$vl.isdisplayonlist eq 1"}
                    ,"{$vl.fieldname}":"{$vo[strtolower($vl['fieldname'])]}"
                    {/if}
                        {/foreach}
                        },
                        {/volist}
            ]
        });

        //总页数大于页码总数
        laypage.render({
            elem: 'laypage'
            ,count: {:$page->count}
            ,curr: {:$page->iPage}
            ,limit: {:$page->pageSize}
            ,layout: ['count', 'prev', 'page', 'next', 'skip']
            ,jump: function(obj){
            if(obj.curr!= "{:$page->iPage}"){
                var jumpUrl = "{:$page->url('currentPage')}";
                jumpUrl = jumpUrl.replace("currentPage",obj.curr);
                location.href = jumpUrl;
            }
        }
        });

        //头工具栏事件
        table.on('toolbar(test-table-toolbar)', function (obj) {
            var checkStatus = table.checkStatus(obj.config.id);
            switch (obj.event) {
                case 'getCheckData':
                    var data = checkStatus.data;
                    layer.alert(JSON.stringify(data));
                    break;
                case 'getCheckLength':
                    var data = checkStatus.data;
                    layer.msg('选中了：' + data.length + ' 个');
                    break;
                case 'isAll':
                    layer.msg(checkStatus.isAll ? '全选' : '未全选');
                    break;
            };
        });

        //监听行工具事件
        table.on('tool(test-table-toolbar)', function (obj) {
            var data = obj.data;
            if (obj.event === 'del') {
                layer.confirm('真的删除行么', function (index) {
                    obj.del();
                    layer.close(index);
                });
            } else if (obj.event === 'edit') {
                layer.prompt({
                    formType: 2
                    , value: data.email
                }, function (value, index) {
                    obj.update({
                        email: value
                    });
                    layer.close(index);
                });
            }
        });

        //监听性别操作
        table.on('switch(test-table-sexDemo)', function (obj) {
            var json = JSON.parse(decodeURIComponent($(this).data('json')));
            layer.tips(this.value + ' ' + this.name + '：' + obj.elem.checked, obj.othis);

            json = table.clearCacheKey(json);
            console.log(json); //当前行数据

        });


    })

    function del_recovery(value) {
        if (!confirm('确定从回收站中恢复吗？'))
        { return false;}
        var b = $(".checked_one");
        var s = '';
        if(value<1)
        {
            for (var i = 0; i < b.length; i++) {
                if (b[i].checked) {
                    s += b[i].value + ',';
                }
            }
            s = s.substr(0, s.length - 1);
        }
        else
        {
            s=value;
        }

        $.ajax({
            url:"{:url('node/recoverychecked')}",
            data:"id="+s,
            type:"post",
            dataType:"json",
            success:function(msg) {
                if (msg == 1) {
                    layer.alert('从回收站中恢复成功', {icon: 1});
                    $(".checked_one").attr("checked", false);
                    location.reload();
                }
                else if(msg==-1){
                    layer.alert('你没有恢复权限', {icon: 4});
                } else {
                    layer.alert('从回收站中恢复失败', {icon: 2});
                    //location.reload();
                }
            }
        })
    }

    //删除选中
    function del_checked(value) {
        if (confirm('确定删除吗？'))
        { }
        else{return false;}
        var b = $(".checked_one");
        var s = '';
        if(value<1)
        {
            for (var i = 0; i < b.length; i++) {
                if (b[i].checked) {
                    s += b[i].value + ',';
                }
            }
            s = s.substr(0, s.length - 1);
        }
        else
        {
            s=value;
        }

        $.ajax({
            url:"{:url('node/delchecked')}",
            data:"id="+s+"&nodeid={$nodeid}",
            type:"post",
            dataType:"json",
            success:function(msg) {
                if (msg == 1) {
                    layer.alert('删除成功', {icon: 1});
                    $(".checked_one").attr("checked", false);
                    location.reload();
                }
                else if(msg==-1){
                    layer.alert('你没有删除权限', {icon: 4});
                } else {
                    layer.alert('删除失败', {icon: 2});
                    //location.reload();
                }
            }
        })
    }

    function show_rqcode(o,id)
    {
        var obj=$("#rqcode");
        obj.html("<img width='150' id='img_rqcode' src='/admin/Qrcode/contenturl/sitecode/{$sitecode}/id/"+id+"' />");
        var yy=event.clientY-150;
        if(yy<10) {yy=10};

        $("#rqcode").css("top",yy+"px").css("left",event.clientX-300+"px");
        obj.show();
    }
    function  close_rqcode() {
        var obj=$("#rqcode");
        obj.html("");
        obj.hide();
    }
</script>
</body>

</html>